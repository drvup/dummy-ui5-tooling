/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/Device","sap/ui/base/ManagedObject","sap/ui/base/Object","sap/ui/base/ObjectPool","./Control","./IntervalTrigger","./RenderManager","./Element","./ResizeHandler","./library","sap/base/assert","sap/base/Log","sap/base/util/Version","sap/base/util/uid","sap/base/util/extend","sap/base/util/deepExtend","sap/ui/dom/containsOrEquals","sap/ui/thirdparty/jquery","sap/ui/events/F6Navigation","sap/ui/events/isMouseEventDelayed","sap/ui/base/EventProvider","sap/ui/dom/jquery/control","sap/ui/dom/jquery/Focusable","sap/ui/dom/jquery/rect"],function(t,e,i,o,s,n,r,a,l,u,f,h,p,d,c,_,g,y,m,b,v){"use strict";var C=u.CSSSize;var S=u.OpenState;var E;var P;function L(){if(E){return E}var t,e;try{t=sap.ui.getCore().getStaticAreaRef();E=sap.ui.getCore().getUIArea(t)}catch(t){h.error(t);throw new Error("Popup cannot be opened because static UIArea cannot be determined.")}e=new s;E.addDependent(e);E=e.getUIArea();e.destroy();return E}function O(t){var e;if(typeof t==="string"){e=document.querySelector(t)}else if(t instanceof a){e=t.getDomRef()}else{e=t}return e}function I(t,e){var i=["left","top","width","height","position"],o;if(e){o=e.getBoundingClientRect();t.css({width:o.width,height:o.height,display:"block",position:"absolute"}).position({my:"left top",at:"left top",of:e})}else{i.forEach(function(e){t[0].style.removeProperty(e)})}}var w=e.extend("sap.ui.core.Popup",{constructor:function(t,i,o,s){f(arguments.length==0||t&&typeof t==="object","oContent must be an object or there may be no arguments at all");f(i===undefined||i===true||i===false,"bModal must be true, false, or undefined");f(o===undefined||o===true||o===false,"bShadow must be true, false, or undefined");f(s===undefined||s===true||s===false,"bAutoClose must be true, false, or undefined");e.apply(this);this._popupUID=d();this.bOpen=false;this.eOpenState=S.CLOSED;this._mEvents={};this._mEvents["sap.ui.core.Popup.addFocusableContent-"+this._popupUID]=this._addFocusableArea;this._mEvents["sap.ui.core.Popup.removeFocusableContent-"+this._popupUID]=this._removeFocusableArea;this._mEvents["sap.ui.core.Popup.closePopup-"+this._popupUID]=this._closePopup;this._mEvents["sap.ui.core.Popup.onFocusEvent-"+this._popupUID]=this.onFocusEvent;this._mEvents["sap.ui.core.Popup.increaseZIndex-"+this._popupUID]=this._increaseMyZIndex;this._mEvents["sap.ui.core.Popup.contains-"+this._popupUID]=this._containsEventBusWrapper;if(t){this.setContent(t)}this._oDefaultPosition={my:w.Dock.CenterCenter,at:w.Dock.CenterCenter,of:document,offset:"0 0",collision:"flip"};this._oPosition=Object.assign({},this._oDefaultPosition);this._bModal=!!i;this._oPreviousFocus=null;this._sInitialFocusId=null;this._bShadow=typeof o==="boolean"?o:true;this._bAutoClose=!!s;this._animations={open:null,close:null};this._durations={open:"fast",close:"fast"};this._iZIndex=-1;this._oBlindLayer=null;this.setNavigationMode();if(this.touchEnabled){this._fAutoCloseHandler=function(t){if(t.isMarked("delayedMouseEvent")||t.isMarked("cancelAutoClose")){return}if(this.eOpenState===S.CLOSING||this.eOpenState===S.CLOSED){return}if(!this._contains(t.target)){this.close()}}}this._F6NavigationHandler=function(t){var e={},i=this._sF6NavMode,o;if(i=="DOCK"){if(this._bModal){i="NONE"}else if(this._oLastPosition&&this._oLastPosition.of){o=this._getOfDom(this._oLastPosition.of);if(!o||o===document){o=null;i="NONE"}}}switch(i){case"SCOPE":e.scope=this._$()[0];break;case"DOCK":e.target=o;var s=y(o).parents("[data-sap-ui-popup]");e.scope=s.length?s[0]:null;break;default:e.skip=true}m.handleF6GroupNavigation(t,e)}},metadata:{library:"sap.ui.core",publicMethods:["open","close","setContent","getContent","setPosition","setShadow","setModal","getModal","setAutoClose","setAutoCloseAreas","setExtraContent","isOpen","getAutoClose","getOpenState","setAnimations","setDurations","attachOpened","attachClosed","detachOpened","detachClosed"],associations:{childPopups:{type:"sap.ui.core.Popup",multiple:true,visibility:"hidden"}},events:{opened:{},closed:{}}}});w.prototype.getChildPopups=function(){return this.getAssociation("childPopups",[])};w.prototype.addChildPopup=function(t){return this.addAssociation("childPopups",t)};w.prototype.removeChildPopup=function(t){return this.removeAssociation("childPopups",t)};w._activateBlindLayer=true;w.blStack=[];w.Dock={BeginTop:"begin top",BeginCenter:"begin center",BeginBottom:"begin bottom",LeftTop:"left top",LeftCenter:"left center",LeftBottom:"left bottom",CenterTop:"center top",CenterCenter:"center center",CenterBottom:"center bottom",RightTop:"right top",RightCenter:"right center",RightBottom:"right bottom",EndTop:"end top",EndCenter:"end center",EndBottom:"end bottom"};w.prototype.touchEnabled=t.support.touch&&(t.browser.safari||!t.system.combi);w.prototype.preventBrowserFocus=t.support.touch&&!t.system.combi;i.extend("sap.ui.core.Popup.Layer",{constructor:function(){var t=this.getDomString();this._$Ref=y(t).appendTo(sap.ui.getCore().getStaticAreaRef())}});w.Layer.prototype.init=function(t,e){this._$Ref.css({visibility:"visible","z-index":e});this.update(t,e);this._$Ref.insertAfter(t).show()};w.Layer.prototype.update=function(t,e){if(t.length){var i=t.rect();this._$Ref.css({left:i.left,top:i.top});if(t.css("right")!="auto"&&t.css("right")!="inherit"){this._$Ref.css({right:t.css("right"),width:"auto"})}else{this._$Ref.css({width:i.width,right:"auto"})}if(t.css("bottom")!="auto"&&t.css("bottom")!="inherit"){this._$Ref.css({bottom:t.css("bottom"),height:"auto"})}else{this._$Ref.css({height:i.height,bottom:"auto"})}if(typeof e==="number"){this._$Ref.css("z-index",e)}}};w.Layer.prototype.reset=function(){if(this._$Ref.length){this._$Ref[0].style.display="none";this._$Ref[0].style.visibility="hidden";this._$Ref.appendTo(sap.ui.getCore().getStaticAreaRef())}};w.Layer.prototype.getDomString=function(){h.error("sap.ui.core.Popup.Layer: getDomString function must be overwritten!");return""};w.Layer.extend("sap.ui.core.Popup.BlindLayer",{constructor:function(){w.Layer.apply(this)}});w.BlindLayer.prototype.getDomString=function(){return'<div class="sapUiBliLy" id="sap-ui-blindlayer-'+d()+'"><iframe scrolling="no" tabIndex="-1"></iframe></div>'};w.prototype.oBlindLayerPool=new o(w.BlindLayer);w.Layer.extend("sap.ui.core.Popup.ShieldLayer",{constructor:function(){w.Layer.apply(this)}});w.ShieldLayer.prototype.getDomString=function(){return'<div class="sapUiPopupShield" id="sap-ui-shieldlayer-'+d()+'"></div>'};w.prototype.oShieldLayerPool=new o(w.ShieldLayer);(function(){var t=0;var e=Math.pow(2,32)-1;w.setInitialZIndex=function(i){if(i>=e){throw new Error("Z-index can't be higher than Number.MAX_SAFE_INTEGER")}t=Math.max(i,this.getLastZIndex())};w.getLastZIndex=function(){return t};w.prototype.getLastZIndex=function(){return w.getLastZIndex()};w.getNextZIndex=function(){t+=10;if(t>=e){throw new Error("Z-index can't be higher than Number.MAX_SAFE_INTEGER")}return t};w.prototype.getNextZIndex=function(){return w.getNextZIndex()}})();var x=function(t,e){if(!t&&e||t&&!e){return false}if(!t&&!e){return true}var i=3;var o=Math.abs(t.left-e.left);var s=Math.abs(t.top-e.top);var n=Math.abs(t.width-e.width);var r=Math.abs(t.height-e.height);if(o>i||s>i||n>i||r>i){return false}return true};w.prototype.open=function(t,e,i,o,n,r,l,u){f(this.oContent,"Popup content must have been set by now");if(this.eOpenState!=S.CLOSED){return}if(typeof t=="string"){u=l;l=r;r=n;n=o;o=i;i=e;e=t;t=-1}if(typeof l==="boolean"||typeof l==="function"){u=l;l=undefined}if(t===undefined){t=-1}f(t===-1||typeof t==="number"&&t%1==0,"iDuration must be an integer (or omitted)");f(e===undefined||typeof e==="string","my must be a string or empty");f(i===undefined||typeof i==="string","at must be a string or empty");f(!o||typeof o==="object"||typeof o==="function","of must be empty or an object");f(!n||typeof n==="string","offset must be empty or a string");f(!r||typeof r==="string","collision must be empty or a string");f(!l||typeof l==="string"||l instanceof a||l instanceof HTMLElement,"within must be either empty, or a string, or a sap.ui.core.Element, or a DOM element");f(!u||typeof u==="boolean"||typeof u==="function","followOf must be either empty, or a boolean, or a function");this.eOpenState=S.OPENING;var p=L(),d;this._bContentAddedToStatic=false;this._bUIAreaPatched=false;if(this.oContent instanceof s){if(!this.oContent.getParent()){p.addContent(this.oContent,true);this._bContentAddedToStatic=true}else if(!this.oContent.getUIArea()){this.oContent.getUIArea=function(){return p};this._bUIAreaPatched=true}d=this.oContent.getUIArea();if(w._bEnableUIAreaCheck&&d.getRootNode().id!==p.getRootNode().id){h.warning("The Popup content is NOT connected with the static-UIArea and may not work properly!")}}this._oPreviousFocus=w.getCurrentFocusInfo();if(this.isInPopup(o)||this.isInPopup(this._oPosition.of)){var c=this.getParentPopupId(o)||this.getParentPopupId(this._oPosition.of);var _="";var g=this.getContent();if(g instanceof a){_=g.getId()}else if(typeof g==="object"){_=g.id}this.addChildToPopup(c,_);this.addChildToPopup(c,this._popupUID)}var y=this._$(true);var m="fast";if(t===0||t>0){m=t}else if(this._durations.open===0||this._durations.open>0){m=this._durations.open}var b;if(e||i||o||n||r||l){b=this._createPosition(e,i,o,n,r,l);this._oPosition=b}else{b=this._oPosition;if(!this._bOwnWithin&&P){this._oPosition.within=P}}if(!b.of){b.of=this._oPosition.of||document}this._iZIndex=this._iZIndex===this.getLastZIndex()?this._iZIndex:this.getNextZIndex();var v=sap.ui.getCore().getStaticAreaRef();y.css({position:"absolute",visibility:"hidden"});if(!(y[0].parentNode==v)){y.appendTo(v)}y.css("z-index",this._iZIndex);h.debug("position popup content "+y.attr("id")+" at "+JSON.stringify(b.at));this._applyPosition(b);if(u!==undefined){this.setFollowOf(u)}y.toggleClass("sapUiShd",this._bShadow);var C=y[0];if(C){C.style.display="none";C.style.visibility="visible"}var E=m==0;this._duringOpen(!E);if(E){this._opened()}else if(this._animations.open){this._animations.open.call(null,y,m,this._opened.bind(this))}else{y.fadeIn(m,this._opened.bind(this))}};w.prototype._getDomRefToFocus=function(){var t=this._$(false,true),e,i;if(this._shouldGetFocusAfterOpen()){if(this._sInitialFocusId){i=sap.ui.getCore().byId(this._sInitialFocusId);if(i){e=i.getFocusDomRef()}e=e||window.document.getElementById(this._sInitialFocusId)}e=e||t.firstFocusableDomRef()}return e};w.prototype._opened=function(){if(this.eOpenState!==S.OPENING){return}this.bOpen=true;var t=this._$(false,true);if(t[0]&&t[0].style){t[0].style.display="block"}if(this._shouldGetFocusAfterOpen()){var e=this._getDomRefToFocus();if(e){e.focus()}var i=this._getOfDom(this._oLastPosition.of);var o=y(i).rect();if(this._oLastOfRect&&o&&!x(this._oLastOfRect,o)){this._applyPosition(this._oLastPosition)}}this.eOpenState=S.OPEN;if(this.getFollowOf()){w.DockTrigger.addListener(w.checkDocking,this)}this._updateBlindLayer();this.fireOpened()};w.prototype._duringOpen=function(t){var e=this._$(false,true),i=sap.ui.getCore().getStaticAreaRef(),o=document.getElementById(i.id+"-firstfe");w._clearSelection();this._setupUserSelection();if(b()){if(this._oTopShieldLayer){clearTimeout(this._iTopShieldRemoveTimer);this._iTopShieldRemoveTimer=null}else{this._oTopShieldLayer=this.oShieldLayerPool.borrowObject(e,this._iZIndex+1)}this._iTopShieldRemoveTimer=setTimeout(function(){this.oShieldLayerPool.returnObject(this._oTopShieldLayer);this._oTopShieldLayer=null;this._iTopShieldRemoveTimer=null}.bind(this),500)}if(this._bModal){this._showBlockLayer()}if(!this.touchEnabled&&t&&o&&this._shouldGetFocusAfterOpen()&&!this.isInPopup(document.activeElement)&&this._getDomRefToFocus()!==document.activeElement){o.focus({preventScroll:true})}if(this.oContent instanceof a){this.oContent.addDelegate(this)}this.bOpen=true;this._activateFocusHandle();this._$(false,true).on("keydown",y.proxy(this._F6NavigationHandler,this));if(this._oBlindLayer){this._resizeListenerId=l.register(this._$().get(0),y.proxy(this.onresize,this))}};w.prototype._shouldGetFocusAfterOpen=function(){return this._bModal||this._bAutoClose||this._sInitialFocusId};w.prototype._contains=function(t){var e=this._$().get(0);if(!e){return false}var i=g(e,t);var o;if(!i){o=this.getChildPopups();i=o.some(function(e){var i=e?window.document.getElementById(e):null;var o=g(i,t);if(!o){var s="sap.ui.core.Popup.contains-"+e;var n={domRef:t};sap.ui.getCore().getEventBus().publish("sap.ui",s,n);o=n.contains}return o})}if(!i){A.forEach(function(e){i=i||y(t).closest(e).length>0})}return i};w.prototype._containsEventBusWrapper=function(t,e,i){i.contains=this._contains(i.domRef)};w.prototype.onFocusEvent=function(e){var i=y.event.fix(e);if(arguments.length>1&&arguments[1]==="sap.ui.core.Popup.onFocusEvent-"+this._popupUID){i=y.event.fix(arguments[2])}var o=i.type=="focus"||i.type=="activate"?"focus":"blur";var s=false;if(o=="focus"){var n=this._$().get(0);if(n){s=this._contains(i.target);h.debug("focus event on "+i.target.id+", contains: "+s);if(this._bModal&&!s){var r=w.blStack.length>0&&w.blStack[w.blStack.length-1].popup===this;if(r){if(t.system.desktop||y(i.target).is(":input")){if(this.oLastBlurredElement){setTimeout(function(){if(this.oLastBlurredElement){this.oLastBlurredElement.focus()}}.bind(this),0)}else{n.focus()}}}}else if(this._bAutoClose&&s&&this._sTimeoutId){clearTimeout(this._sTimeoutId);this._sTimeoutId=null}}}else if(o=="blur"){h.debug("blur event on "+i.target.id);if(this._bModal){this.oLastBlurredElement=i.target}else if(this._bAutoClose){if(!this.touchEnabled&&!this._sTimeoutId){if(i.target===document.activeElement){return}var a=typeof this._durations.close==="string"?0:this._durations.close;this._sTimeoutId=setTimeout(function(){this.close(a,"autocloseBlur");var t=this._oLastPosition&&this._oLastPosition.of;if(t){var e=this.getParentPopupId(t);if(e){var o="sap.ui.core.Popup.onFocusEvent-"+e;sap.ui.getCore().getEventBus().publish("sap.ui",o,i)}}}.bind(this),a)}}}};w.prototype.setInitialFocusId=function(t){f(!t||typeof t==="string","sId must be a string or empty");this._sInitialFocusId=t};w.prototype.close=function(t){if(w._autoCloseDebug){return}if(this._sTimeoutId){clearTimeout(this._sTimeoutId);this._sTimeoutId=null;if(arguments.length>1){var e=arguments[1];if(typeof e=="string"&&e=="autocloseBlur"&&this._isFocusInsidePopup()){return}}}f(t===undefined||typeof t==="number"&&t%1==0,"iDuration must be empty or an integer");if(this.eOpenState==S.CLOSED||this.eOpenState==S.CLOSING){return}var i="fast";if(t===0||t>0){i=t}else if(this._durations.close===0||this._durations.close>0){i=this._durations.close}this.eOpenState=S.CLOSING;if(this.getFollowOf()){w.DockTrigger.removeListener(w.checkDocking,this)}if(this.oContent){if(this._bContentAddedToStatic){sap.ui.getCore().getEventBus().publish("sap.ui","__beforePopupClose",{domNode:this._$().get(0)});var o=sap.ui.getCore().getStaticAreaRef();o=sap.ui.getCore().getUIArea(o);o.removeContent(o.indexOfContent(this.oContent),true)}else if(this._bUIAreaPatched){delete this.oContent.getUIArea}}this._bContentAddedToStatic=false;this._bUIAreaPatched=false;this._sTimeoutId=null;this._deactivateFocusHandle();this._$(false,true).off("keydown",this._F6NavigationHandler);if(this.oContent instanceof a){this.oContent.removeDelegate(this)}var s=this._$();if(this._bEventBusEventsRegistered){this._unregisterEventBusEvents()}if(this._oBlindLayer){this.oBlindLayerPool.returnObject(this._oBlindLayer)}this._oBlindLayer=null;if(b()){if(this._oBottomShieldLayer){clearTimeout(this._iBottomShieldRemoveTimer);this._iBottomShieldRemoveTimer=null}else{this._oBottomShieldLayer=this.oShieldLayerPool.borrowObject(s,this._iZIndex-3)}this._iBottomShieldRemoveTimer=setTimeout(function(){this.oShieldLayerPool.returnObject(this._oBottomShieldLayer);this._oBottomShieldLayer=null;this._iBottomShieldRemoveTimer=null}.bind(this),500)}if(this.isInPopup(this._oLastPosition.of)){var n=this.getParentPopupId(this._oLastPosition.of);var r="";var l=this.getContent();if(l instanceof a){r=l.getId()}else if(typeof l==="object"){r=l.id}this.removeChildFromPopup(n,r);this.removeChildFromPopup(n,this._popupUID)}if(this._bModal&&this.preventBrowserFocus){s.one("mousedown",function(t){t.preventDefault()})}this._duringClose();if(i==0){this._closed()}else if(this._animations.close){this._animations.close.call(null,s,i,this._closed.bind(this))}else{s.fadeOut(i,this._closed.bind(this))}};w.prototype._closed=function(){var t=this._$(false,true);if(this._bModal){this._hideBlockLayer()}w._clearSelection();this._restoreUserSelection();if(t.length){var e=t.get(0);if(e){e.style.display="none";e.style.visibility="hidden";e.style.left="0px";e.style.top="0px";e.style.right=""}t=this._$(false,true);e=t.length?t[0]:null;if(e){e.style.display="none";e.style.visibility="hidden";e.style.left="0px";e.style.top="0px";e.style.right=""}}if(this._bModal){w.applyFocusInfo(this._oPreviousFocus);this._oPreviousFocus=null;this.oLastBlurredElement=null}this.bOpen=false;this.eOpenState=S.CLOSED;var i=this.getChildPopups();for(var o=0,s=i.length;o<s;o++){this.closePopup(i[o])}this.fireClosed()};w.prototype._duringClose=function(){if(this._resizeListenerId){l.deregister(this._resizeListenerId);this._resizeListenerId=null}};w.getCurrentFocusInfo=function(){var t=null;var e=sap.ui.getCore().getCurrentFocusedControlId();if(e){var i=sap.ui.getCore().byId(e);t={sFocusId:e,oFocusInfo:i?i.getFocusInfo():{}}}else{try{var o=document.activeElement;if(o&&o.nodeName){t={sFocusId:o.id,oFocusedElement:o,oFocusInfo:{}}}}catch(e){t=null}}if(t){t.popup=this}return t};w.applyFocusInfo=function(t){var e={preventScroll:true};if(t){var i=sap.ui.getCore().byId(t.sFocusId);if(i){i.applyFocusInfo(Object.assign(e,t.oFocusInfo))}else{var o=(t.sFocusId?window.document.getElementById(t.sFocusId):null)||t.oFocusedElement;if(o){o.focus(e)}}}};w.prototype.setContent=function(t){f(typeof t==="object","oContent must be an object");this.oContent=t;return this};w.prototype.getContent=function(){return this.oContent};w.prototype.setPosition=function(t,e,i,o,s,n){f(typeof t==="string","my must be a string");f(typeof e==="string"||typeof e==="object"&&typeof e.left==="number"&&typeof e.top==="number","my must be a string or an object with 'left' and 'top' properties");f(!i||typeof i==="object"||typeof i==="function","of must be empty or an object");f(!o||typeof o==="string","offset must be empty or a string");f(!s||typeof s==="string","collision must be empty or a string");f(!n||typeof n==="string"||n instanceof a||n instanceof HTMLElement,"within must be either empty, or a string, or a sap.ui.core.Element, or a DOM element");this._oPosition=this._createPosition(t,e,i,o,s,n);if(this.eOpenState!=S.CLOSED){this._applyPosition(this._oPosition);if(this._oBlindLayer){this._oBlindLayer.update(this._$())}}return this};w.prototype._createPosition=function(t,e,i,o,s,n){var r=false;if(t&&(t.indexOf("+")>=0||t.indexOf("-")>=0)){r=true;if(o&&o!="0 0"){h.warning("offset used in my and in offset, the offset value will be ignored","sap.ui.core.Popup","setPosition")}o=null}var a=c({},this._oDefaultPosition,{my:t||this._oDefaultPosition.my,at:e||this._oDefaultPosition.at,of:i,offset:o,collision:s});if(n||P){a.within=n||P}this._bOwnWithin=!!n;if(!y.ui.version){if(w._bNewOffset==null){w._bNewOffset=true;var l=y(document.createElement("div"));l.position({of:window,using:function(t,e){w._bNewOffset=e!==undefined}})}}var u=[];var f=[];if(w._bNewOffset||p(y.ui.version).compareTo("1.8.23")>0){if(o&&o!="0 0"){u=a.my.split(" ");f=o.split(" ");var d=[parseInt(f[0])<0?"":"+",parseInt(f[1])<0?"":"+"];a.my=u[0]+d[0]+f[0]+" "+u[1]+d[1]+f[1];a.offset=null}}else if(r){u=a.my.split(" ");f=["",""];var _=u[0].indexOf("+");if(_<0){_=u[0].indexOf("-")}if(_>=0){f[0]=u[0].slice(_);u[0]=u[0].slice(0,_)}_=u[1].indexOf("+");if(_<0){_=u[1].indexOf("-")}if(_>=0){f[1]=u[1].slice(_);u[1]=u[1].slice(0,_)}a.my=u[0]+" "+u[1];a.offset=f[0]+" "+f[1]}return a};w.prototype._getPositionOffset=function(){var t=[];if(this._oPosition.my&&(this._oPosition.my.indexOf("+")>=0||this._oPosition.my.indexOf("-")>=0)){var e=this._oPosition.my.split(" ");var i=e[0].indexOf("+");if(i<0){i=e[0].indexOf("-")}if(i>=0){t[0]=e[0].slice(i)}i=e[1].indexOf("+");if(i<0){i=e[1].indexOf("-")}if(i>=0){t[1]=e[1].slice(i)}}else if(this._oPosition.offset){t=this._oPosition.offset.split(" ")}return t};w.prototype._applyPosition=function(t){var e=sap.ui.getCore().getConfiguration().getRTL();var i=this._$();if(i.length){var o=t.at;var s=i.get(0);if(typeof o==="string"){s.style.display="block";s.style.left="";s.style.right="";i.position(this._resolveReference(this._convertPositionRTL(t,e)));this._fixPositioning(t,e)}else if(C.isValid(o.left)&&C.isValid(o.top)){i.css({left:o.left,top:o.top})}else if(C.isValid(o.right)&&C.isValid(o.top)){i.css({right:o.right,top:o.top})}else if(typeof o.left==="number"&&typeof o.top==="number"){var n=i[0];if(n&&n.style.right){var r=i[0].getBoundingClientRect().width;i.css({right:document.documentElement.clientWidth-(o.left+r)+"px",top:o.top+"px"})}else{i.css({left:o.left+"px",top:o.top+"px"})}}this._oLastPosition=t;this._oLastOfRect=this._calcOfRect(t.of)}};w.prototype._calcOfRect=function(t){var e=this._getOfDom(t);if(e){return y(e).rect()}return null};w.prototype._getOfDom=function(t){if(t instanceof y.Event){return null}var e;if(typeof t==="string"){e=y(document.getElementById(t))}else if(t instanceof y){e=t}else{e=y(t instanceof a?t.getDomRef():t)}return e[0]};w.prototype._convertPositionRTL=function(t,e){var i=Object.assign({},t);if(e){var o=false;if(i.my&&(i.my.indexOf("+")>=0||i.my.indexOf("-")>=0)){o=true}if((i.offset||o)&&(i.my.indexOf("begin")>-1||i.my.indexOf("end")>-1)&&(i.at.indexOf("begin")>-1||i.at.indexOf("end")>-1)){if(o){var s=i.my.split(" ");if(s.length==2){i.my="";if(s[0]){if(s[0].indexOf("begin")>-1||s[0].indexOf("end")>-1){if(s[0].indexOf("+")>-1){s[0]=s[0].replace("+","-")}else if(s[0].indexOf("-")>-1){s[0]=s[0].replace("-","+")}}i.my=s[0]}if(s[1]){if(s[1].indexOf("begin")>-1||s[1].indexOf("end")>-1){if(s[1].indexOf("+")>-1){s[1]=s[1].replace("+","-")}else if(s[1].indexOf("-")>-1){s[1]=s[1].replace("-","+")}}if(s[0]){i.my=i.my+" "}i.my=i.my+s[1]}}}else{i.offset=this._mirrorOffset(i.offset)}}i.my=i.my.replace("begin","right").replace("end","left");i.at=i.at.replace("begin","right").replace("end","left")}else{i.my=i.my.replace("end","right").replace("begin","left");i.at=i.at.replace("end","right").replace("begin","left")}return i};w.prototype._mirrorOffset=function(t){var e=String(t).trim().split(/\s/);var i=parseInt(e[0]);return-i+" "+e[e.length-1]};w.prototype._fixPositioning=function(t,e){var i=t.my;if(typeof i==="string"){if(w._isPositionFixingNeeded(i,e)){var o=this._$();var s=y(window).width()-o[0].getBoundingClientRect().width-o.offset().left;o.css({right:s+"px",left:""})}}};w._isPositionFixingNeeded=function(t,e){return e&&(t.indexOf("right")>-1||t.indexOf("begin")>-1||t.indexOf("center")>-1)||!e&&(t.indexOf("right")>-1||t.indexOf("end")>-1)};w.prototype._resolveReference=function(t){var e,i=["of","within"];i.forEach(function(i){if(t[i]instanceof a){e=e||{};e[i]=t[i].getDomRef()}});return e?Object.assign({},t,e):t};w.prototype.setShadow=function(t){f(typeof t==="boolean","bShowShadow must be boolean");this._bShadow=t;if(this.eOpenState!=S.CLOSED){this._$().toggleClass("sapUiShd",t)}return this};w.prototype.setModal=function(t,e){f(typeof t==="boolean","bModal must be boolean");f(!e||typeof e==="string","sModalCSSClass must be empty or a string");var i=this._bModal;this._bModal=t;this._sModalCSSClass=e;if(this.isOpen()){if(i!==t){w._clearSelection();if(t){this._setupUserSelection();this._showBlockLayer()}else{this._hideBlockLayer();this._restoreUserSelection()}if(this.touchEnabled&&this._bAutoClose){if(!t){y(document).on("touchstart mousedown",y.proxy(this._fAutoCloseHandler,this))}else{y(document).off("touchstart mousedown",this._fAutoCloseHandler)}}}}return this};w.prototype.getModal=function(){return this._bModal};w.prototype.setNavigationMode=function(t){if(t!="NONE"&&t!="DOCK"&&t!="SCOPE"){this._sF6NavMode="NONE"}this._sF6NavMode=t};w.prototype.setAutoClose=function(t){f(typeof t==="boolean","bAutoClose must be boolean");if(this.touchEnabled&&this.isOpen()&&this._bAutoClose!==t){if(!this._bModal){if(t){y(document).on("touchstart mousedown",y.proxy(this._fAutoCloseHandler,this))}else{y(document).off("touchstart mousedown",this._fAutoCloseHandler)}}}this._bAutoClose=t;return this};w.prototype.setExtraContent=function(t){f(Array.isArray(t),"Extra popup content must be an array which contains either sap.ui.core.Element, DOM Element or an ID");if(!this._aExtraContent){this._aExtraContent=[]}var e=function(t){return{onBeforeRendering:function(){var e=t.getDomRef();if(e&&this.isOpen()){e.removeEventListener("blur",this.fEventHandler,true)}},onAfterRendering:function(){var e=t.getDomRef();if(e&&this.isOpen()){e.addEventListener("blur",this.fEventHandler,true)}}}};var i,o,s,n;for(var r=0,l=t.length;r<l;r++){o=t[r];if(o instanceof a){i=o.getId()}else if(typeof o==="object"){i=o.id}else if(typeof o==="string"){i=o}if(this.getChildPopups().indexOf(i)===-1){this.addChildPopup(i);n={id:i};if(o instanceof a){s=e(o);o.addEventDelegate(s,this);n.delegate=s}this._aExtraContent.push(n)}}return this};w.prototype.setAutoCloseAreas=w.prototype.setExtraContent;w.prototype.setAnimations=function(t,e){f(t===null||typeof t==="function","fnOpen must be a function");f(e===null||typeof e==="function","fnClose must be a function");if(t&&typeof t=="function"){this._animations.open=t}if(e&&typeof e=="function"){this._animations.close=e}return this};w.prototype.setDurations=function(t,e){f(t===null||typeof t==="number"&&t%1==0,"iOpenDuration must be null or an integer");f(!e||typeof e==="number"&&e%1==0,"iOpenDuration must be undefined or an integer");if(t>0||t===0){this._durations.open=t}if(e>0||e===0){this._durations.close=e}return this};w.CLOSE_ON_SCROLL="close_Popup_if_of_is_moved";w.prototype._fnCloseOnScroll=function(t){this.close()};w.prototype.setFollowOf=function(t){w.DockTrigger.removeListener(w.checkDocking,this);var e=false;this._bFollowOf=true;this._followOfHandler=null;if(typeof t==="function"){this._followOfHandler=t;e=true}else if(typeof t==="boolean"){e=t}else if(t===w.CLOSE_ON_SCROLL){this._followOfHandler=this._fnCloseOnScroll;e=true}else{this._bFollowOf=false;if(t!==null){h.error("Trying to set an invalid type to 'followOf: "+t)}}if(e&&this._oLastPosition){this._oLastOfRect=this._calcOfRect(this._oLastPosition.of)}if(this._bFollowOf&&this.getOpenState()===S.OPEN){w.DockTrigger.addListener(w.checkDocking,this)}};w.prototype.getAutoClose=function(){return this._bAutoClose};w.prototype.getFollowOf=function(){if(this._bFollowOf){return typeof this._followOfHandler==="function"?this._followOfHandler:true}return false};w.prototype.isOpen=function(){return this.bOpen};w.prototype.getOpenState=function(){return this.eOpenState};w.prototype.destroy=function(){if(this._resizeListenerId){l.deregister(this._resizeListenerId);this._resizeListenerId=null}this.close(0);this.oContent=null;if(this._bFollowOf){this.setFollowOf(null)}if(this._bEventBusEventsRegistered){this._unregisterEventBusEvents()}if(this._iTopShieldRemoveTimer){clearTimeout(this._iTopShieldRemoveTimer);this.oShieldLayerPool.returnObject(this._oTopShieldLayer);this._oTopShieldLayer=null;this._iTopShieldRemoveTimer=null}if(this._iBottomShieldRemoveTimer){clearTimeout(this._iBottomShieldRemoveTimer);this.oShieldLayerPool.returnObject(this._oBottomShieldLayer);this._oBottomShieldLayer=null;this._iBottomShieldRemoveTimer=null}if(this._aExtraContent){var t;this._aExtraContent.forEach(function(e){if(e.delegate){t=y(document.getElementById(e.id)).control(0);if(t){t.removeEventDelegate(e.delegate)}}})}e.prototype.destroy.apply(this,arguments)};w.prototype.exit=function(){delete this._mEvents};w.prototype._addFocusEventListeners=function(){if(!this.fEventHandler){this.fEventHandler=y.proxy(this.onFocusEvent,this)}var t=this._$();var e=this.getChildPopups();var i={};var o=0,s=0;if(t.length){if(document.addEventListener){document.addEventListener("focus",this.fEventHandler,true);t.get(0).addEventListener("blur",this.fEventHandler,true);for(o=0,s=e.length;o<s;o++){i=e[o]?window.document.getElementById(e[o]):null;if(i){i.addEventListener("blur",this.fEventHandler,true)}}}else{y(document).on("activate."+this._popupUID,this.fEventHandler);t.on("deactivate."+this._popupUID,this.fEventHandler);for(o=0,s=e.length;o<s;o++){i=e[o]?window.document.getElementById(e[o]):null;if(i){y(i).on("deactivate."+this._popupUID,this.fEventHandler)}}}}};w.prototype._removeFocusEventListeners=function(){var t=this._$(false,true);if(!t.length){return}var e=this.getChildPopups();var i={};var o=0,s=0;if(document.removeEventListener){document.removeEventListener("focus",this.fEventHandler,true);t.get(0).removeEventListener("blur",this.fEventHandler,true);for(o=0,s=e.length;o<s;o++){i=e[o]?window.document.getElementById(e[o]):null;if(i){i.removeEventListener("blur",this.fEventHandler,true)}this.closePopup(e[o])}}else{y(document).off("activate."+this._popupUID,this.fEventHandler);t.off("deactivate."+this._popupUID,this.fEventHandler);for(o=0,s=e.length;o<s;o++){i=e[o]?window.document.getElementById(e[o]):null;if(i){y(i).off("deactivate."+this._popupUID,this.fEventHandler)}}}this.fEventHandler=null};w.prototype._activateFocusHandle=function(){if(this._bModal||this._bAutoClose){this._addFocusEventListeners()}if(this.touchEnabled&&!this._bModal&&this._bAutoClose){y(document).on("touchstart mousedown",y.proxy(this._fAutoCloseHandler,this))}};w.prototype._deactivateFocusHandle=function(){if(this.fEventHandler){this._removeFocusEventListeners()}if(this.touchEnabled&&!this._bModal&&this._bAutoClose){y(document).off("touchstart mousedown",this._fAutoCloseHandler)}};w.prototype._registerEventBusEvents=function(){var t=this;y.each(t._mEvents,function(e,i){sap.ui.getCore().getEventBus().subscribe("sap.ui",e,i,t)});this._bEventBusEventsRegistered=true};w.prototype._unregisterEventBusEvents=function(){var t=this;y.each(t._mEvents,function(e,i){sap.ui.getCore().getEventBus().unsubscribe("sap.ui",e,i,t)});delete this._bEventBusEventsRegistered};w.prototype._addFocusableArea=function(t,e,i){if(this.getChildPopups().indexOf(i.id)===-1){this.addChildPopup(i.id)}};w.prototype._removeFocusableArea=function(t,e,i){this.removeChildPopup(i.id)};w.prototype._closePopup=function(t,e,i){this.close(typeof this._durations.close==="string"?0:this._durations.close)};w.prototype._setIdentity=function(t){if(typeof t==="object"){t.attr("data-sap-ui-popup",this._popupUID)}else{h.warning("Incorrect DomRef-type for 'setIdentity': "+t,this);return}if(!this._bEventBusEventsRegistered){this._registerEventBusEvents()}};w.prototype._$=function(t,e){var i;if(this.oContent instanceof s){i=this.oContent.$();if(t||i.length===0&&!e){h.info("Rendering of popup content: "+this.oContent.getId());if(i.length>0){r.preserveContent(i[0],true,false)}sap.ui.getCore().getRenderManager().render(this.oContent,sap.ui.getCore().getStaticAreaRef());i=this.oContent.$()}}else if(this.oContent instanceof a){i=this.oContent.$()}else{i=y(this.oContent)}this._setIdentity(i);return i};function F(t){if(w._blockLayerStateProvider){w._blockLayerStateProvider.fireEvent("blockLayerStateChange",t)}}w.attachBlockLayerStateChange=function(t,e,i){if(!w._blockLayerStateProvider){w._blockLayerStateProvider=new v}w._blockLayerStateProvider.attachEvent("blockLayerStateChange",t,e,i)};w.detachBlockLayerStateChange=function(t,e){if(w._blockLayerStateProvider){w._blockLayerStateProvider.detachEvent("blockLayerStateChange",t,e)}};w.prototype._showBlockLayer=function(){var t=y("#sap-ui-blocklayer-popup"),e="sapUiBLy"+(this._sModalCSSClass?" "+this._sModalCSSClass:""),i;if(t.length===0){t=y('<div id="sap-ui-blocklayer-popup" tabindex="0" class="'+e+'"></div>');t.appendTo(sap.ui.getCore().getStaticAreaRef())}else{t.removeClass().addClass(e)}w.blStack.push({zIndex:this._iZIndex-2,popup:this});if(this._oLastPosition.within){i=O(this._oLastPosition.within);i.classList.add("sapUiBLyBack")}else{y("html").addClass("sapUiBLyBack")}I(t,i);t.css({"z-index":this._iZIndex-2,visibility:"visible"}).show();if(w.blStack.length===1){F({visible:true,zIndex:w.blStack[0].zIndex})}};w.prototype._hideBlockLayer=function(){var t=y("#sap-ui-blocklayer-popup"),e=this,i;if(t.length){var o=t.get(0),s;if(w.blStack.length>1){w.blStack=w.blStack.filter(function(t){return t.popup!==e});i=w.blStack[w.blStack.length-1];o.style.zIndex=i.zIndex;o.style.visibility="visible";o.style.display="block"}else{i=w.blStack.pop();o.style.visibility="hidden";o.style.display="none"}s=O(i.popup._oLastPosition.within);if(w.blStack.length>0){I(t,s)}window.setTimeout(function(){if(s){s.classList.remove("sapUiBLyBack")}else{y("html").removeClass("sapUiBLyBack")}},0);if(w.blStack.length===0){F({visible:false,zIndex:i.zIndex})}}};w.prototype._isFocusInsidePopup=function(){var t=this._$(false).get(0);if(t&&g(t,document.activeElement)){return true}return false};w.DockTrigger=n;w.checkDocking=function(){if(this.getOpenState()===S.OPEN){var t=this._getOfDom(this._oLastPosition.of),e;if(t){if(t===window||t===window.document||g(document.documentElement,t)){e=y(t).rect()}else if(t.id){var i=window.document.getElementById(t.id);var o=y(i).rect();if(o&&!x(e,o)){e=o;this._oLastPosition.of=i}}}if(!e){this.close();return}else if(e.left===0&&e.top===0&&e.height===0&&e.height===0&&this._oLastPosition.of.id){this._oLastPosition.of=window.document.getElementById(this._oLastPosition.of.id);t=this._getOfDom(this._oLastPosition.of);e=y(t).rect();if(!e){this.close();return}}if(this._oLastOfRect){if(!x(this._oLastOfRect,e)){if(this._followOfHandler){var s=_({},this._oLastPosition),n=_({},this._oLastOfRect);this._followOfHandler({lastPosition:s,lastOfRect:n,currentOfRect:e})}else{this._applyPosition(this._oLastPosition)}}}}};w.prototype.ontouchstart=function(t){this.onmousedown(t,true);this._bMousedownCalled=true};w.prototype.onmousedown=function(t,e){if(this._bMousedownCalled&&!e){this._bMousedownCalled=false;return}if(this._iZIndex===this.getLastZIndex()||this.getModal()){return}this._increaseMyZIndex("","mousedown",t)};w.prototype._increaseMyZIndex=function(t,e,i){var o=this.getParentPopup(this._oLastPosition.of);if(i&&i.type==="mousedown"||i&&i.isFromParentPopup||o.length===0){this._iZIndex=this.getNextZIndex();var s=this._$(false,true);s.css("z-index",this._iZIndex);if(this._oBlindLayer){this._oBlindLayer.update(s,this._iZIndex-1)}if(i&&!i.type||i&&i.type!="mousedown"||e==="mousedown"){var n=this.getChildPopups();for(var r=0,a=n.length;r<a;r++){this.increaseZIndex(n[r],true)}}}else if(o.length>0){var l=y(o.get(0)).attr("data-sap-ui-popup");this.increaseZIndex(l,false)}};w.prototype.onAfterRendering=function(){var t=this.getContent();var e=t instanceof a?t.$():y(t);e.toggleClass("sapUiShd",this._bShadow);w._clearSelection();this._setupUserSelection();e.css("position","absolute");this._setIdentity(e);var i=e[0];var o=i.style.left;var s=i.style.right;var n=i.style.top;var r=i.style.bottom;if(!(o&&o!="auto"||s&&s!="auto"||n&&n!="auto"||r&&r!="auto")){h.debug("reposition popup content "+e.attr("id")+" at "+JSON.stringify(this._oLastPosition.at));this._applyPosition(this._oLastPosition)}e.show().css({visibility:"visible","z-index":this._iZIndex});if(this._oBlindLayer){this._resizeListenerId=l.register(this._$().get(0),y.proxy(this.onresize,this))}if(this.isOpen()&&(this.getModal()||this.getAutoClose())){this._addFocusEventListeners()}this._$(false,true).on("keydown",y.proxy(this._F6NavigationHandler,this))};w.prototype.onBeforeRendering=function(){if(this._resizeListenerId){l.deregister(this._resizeListenerId);this._resizeListenerId=null}if(this.isOpen()&&(this.getModal()||this.getAutoClose())){this._removeFocusEventListeners()}this._$(false,true).off("keydown",this._F6NavigationHandler)};w.prototype.onresize=function(){if(this.eOpenState!=S.CLOSED&&this._oBlindLayer){var t=this;setTimeout(function(){t._updateBlindLayer()},0)}};w.prototype._updateBlindLayer=function(){if(this.eOpenState!=S.CLOSED&&this._oBlindLayer){this._oBlindLayer.update(this._$(false,true))}};w.prototype.isInPopup=function(t){var e=this.getParentPopup(t);return e&&e.length>0};w.prototype.getParentPopup=function(t){var e=t?t:this;var i=y(e instanceof a?e.getDomRef():e);return i.closest("[data-sap-ui-popup]")};w.prototype.getParentPopupId=function(t){var e=this.getParentPopup(t);return e.attr("data-sap-ui-popup")};w.prototype.addChildToPopup=function(t,e){var i="sap.ui.core.Popup.addFocusableContent-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",i,{id:e})};w.prototype.removeChildFromPopup=function(t,e){var i="sap.ui.core.Popup.removeFocusableContent-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",i,{id:e})};w.prototype.closePopup=function(t){var e="sap.ui.core.Popup.closePopup-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",e)};w.prototype.increaseZIndex=function(t,e){var i="sap.ui.core.Popup.increaseZIndex-"+t;sap.ui.getCore().getEventBus().publish("sap.ui",i,{isFromParentPopup:e?e:false})};w.prototype.focusTabChain=function(t){var e=t.event.target,i=t.that.getMetadata().getName(),o;if(!t.$FocusablesContent||!t.$FocusablesFooter||!t.$FocusablesContent.length&&!t.$FocusablesFooter.length){return}if(e.id===t.firstFocusable){h.debug("First dummy focus element was focused","",i);if(t.$FocusablesFooter.length>0){h.debug("Last footer element will be focused","",i);o=t.$FocusablesFooter[t.$FocusablesFooter.length-1]}else{h.debug("Last content element will be focused","",i);o=t.$FocusablesContent[t.$FocusablesContent.length-1]}}else if(e.id===t.lastFocusable){h.debug("Last dummy focus element was focues","",i);if(t.$FocusablesContent.length>0){h.debug("First content element will be focused","",i);o=t.$FocusablesContent[0]}else{h.debug("First footer element will be focused","",i);o=t.$FocusablesFooter[0]}}if(o){setTimeout(function(){var t=sap.ui.getCore().byId(o.id);if(t instanceof s){h.debug("Focus will be handled by "+t.getMetadata().getName(),"",i)}else{h.debug("oFocusDomRef will be focused","",i)}if(t){t.focus()}else if(o){o.focus()}return t?t.getId():o.id},0)}};w.prototype._setupUserSelection=function(){var t=this._$(false,true);w._markAsUserSelectable(t,this._bModal||w.blStack.length>0);if(this._bModal){if(w.blStack.length>0){var e=w.blStack[w.blStack.length-1];var i=function(t){return t.popup.getId()};if(w.blStack.map(i).indexOf(this.getId())===-1){w._markAsNotUserSelectable(e.popup._$(false,true),true)}else if(e.popup.getId()!==this.getId()){w._markAsNotUserSelectable(t,true)}}else{w._markAsNotUserSelectable(y("html"),true);w._markExternalContentAsUserSelectable(true)}}};w.prototype._restoreUserSelection=function(){var t=this._$(false,true);w._markAsNotUserSelectable(t,false);if(w.blStack.length>0){w._markAsUserSelectable(w.blStack[w.blStack.length-1].popup._$(false,true),true)}else{w._markAsUserSelectable(y("html"),false);w._markExternalContentAsNotUserSelectable(false)}};w._clearSelection=function(){var t=document.getSelection();if(!t.isCollapsed){t.removeAllRanges()}};w._markAsUserSelectable=function(t,e){t.removeClass("sapUiNotUserSelectable");if(e){t.addClass("sapUiUserSelectable")}};w._markAsNotUserSelectable=function(t,e){t.removeClass("sapUiUserSelectable");if(e){t.addClass("sapUiNotUserSelectable")}};var A=new Set,B="[data-sap-ui-integration-popup-content]";A.add(B);w.addExternalContent=function(t,e){if(!Array.isArray(t)){t=[t]}t.forEach(Set.prototype.add.bind(A));if(e){w.markExternalContentAsSelectable()}};w.removeExternalContent=function(t,e){if(!Array.isArray(t)){t=[t]}if(e){w.markExternalContentAsNotSelectable()}t.forEach(function(t){if(t!==B){A.delete(t)}})};w.markExternalContentAsSelectable=function(){w._clearSelection();if(w.blStack.length>0){w._markExternalContentAsUserSelectable(true)}};w.markExternalContentAsNotSelectable=function(){w._clearSelection();if(w.blStack.length>0){w._markExternalContentAsNotUserSelectable(false)}};w._getExternalContent=function(){var t=[];if(A.size>0){A.forEach(function(e){var i=y(e);if(i.length>0){t.push(i)}})}return t};w._markExternalContentAsUserSelectable=function(t){var e=w._getExternalContent();e.forEach(function(e){w._markAsUserSelectable(e,t)})};w._markExternalContentAsNotUserSelectable=function(t){var e=w._getExternalContent();e.forEach(function(e){w._markAsNotUserSelectable(e,t)})};w.setWithinArea=function(t){P=t};w.getWithinArea=function(){return P};w.getWithinAreaDomRef=function(){return O(P)||window};return w});