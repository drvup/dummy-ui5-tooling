/*
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/model/SelectionModel","./SelectionPlugin","../utils/TableUtils","../library"],function(e,t,o,i){"use strict";var n=i.SelectionMode;var l=t.extend("sap.ui.table.plugins.SelectionModelSelection",{metadata:{library:"sap.ui.table",events:{selectionChange:{parameters:{indices:{type:"int[]"},selectAll:{type:"boolean"}}}}}});l.prototype.init=function(){t.prototype.init.apply(this,arguments);this.oSelectionModel=new e(this._getSelectionMode)};l.prototype.exit=function(){t.prototype.exit.apply(this,arguments);if(this.oSelectionModel){this.oSelectionModel.destroy();this.oSelectionModel=null}};l.prototype.onActivate=function(){t.prototype.onActivate.apply(this,arguments);this.oSelectionModel.attachSelectionChanged(this._onSelectionChange,this)};l.prototype.onDeactivate=function(){t.prototype.onDeactivate.apply(this,arguments);this.oSelectionModel.detachSelectionChanged(this._onSelectionChange,this);this.oSelectionModel.clearSelection();r(this,this.getTableBinding())};l.prototype.getRenderConfig=function(){return{headerSelector:{type:"toggle",visible:o.hasSelectAll(this.getTable())}}};l.prototype.onHeaderSelectorPress=function(){if(this.getRenderConfig().headerSelector.visible){this.getTable()._toggleSelectAll()}};l.prototype.onKeyboardShortcut=function(e){if(e==="toggle"){this.getTable()._toggleSelectAll()}else if(e==="clear"){this.clearSelection()}};l.prototype.addSelectionInterval=function(e,t){if(!this.oSelectionModel||this._getSelectionMode()===n.None){return}this.oSelectionModel.addSelectionInterval(e,t)};l.prototype.clearSelection=function(){if(this.oSelectionModel){this.oSelectionModel.clearSelection()}};l.prototype.getSelectedIndex=function(){if(this.oSelectionModel){return this.oSelectionModel.getLeadSelectedIndex()}return-1};l.prototype.getSelectedIndices=function(){if(this.oSelectionModel){return this.oSelectionModel.getSelectedIndices()}return[]};l.prototype.getSelectableCount=function(){var e=this.getTableBinding();return e?e.getLength():0};l.prototype.getSelectedCount=function(){return this.getSelectedIndices().length};l.prototype.isIndexSelectable=function(e){return e>=0&&e<=this._getHighestSelectableIndex()};l.prototype.isIndexSelected=function(e){return this.getSelectedIndices().indexOf(e)!==-1};l.prototype.removeSelectionInterval=function(e,t){if(this.oSelectionModel){this.oSelectionModel.removeSelectionInterval(e,t)}};l.prototype.selectAll=function(){if(!this.oSelectionModel||this._getSelectionMode()===n.None){return}this.oSelectionModel.selectAll(this._getHighestSelectableIndex())};l.prototype.setSelectedIndex=function(e){if(this._getSelectionMode()===n.None){return}if(e===-1){this.clearSelection()}else{this.setSelectionInterval(e,e)}};l.prototype.setSelectionInterval=function(e,t){if(!this.oSelectionModel||this._getSelectionMode()===n.None){return}this.oSelectionModel.setSelectionInterval(e,t)};l.prototype.setSelectionMode=function(o){var i=this._getSelectionMode();t.prototype._setSelectionMode.apply(this,arguments);if(this._getSelectionMode()!==i){this.clearSelection()}if(this.oSelectionModel){var l=o===n.MultiToggle?e.MULTI_SELECTION:e.SINGLE_SELECTION;this.oSelectionModel.setSelectionMode(l)}return this};l.prototype._getHighestSelectableIndex=function(){var e=this.getTableBinding();return e?e.getLength()-1:-1};l.prototype._onSelectionChange=function(e){var t=e.getParameter("rowIndices");var o=e.getParameter("selectAll");this.fireSelectionChange({rowIndices:t,selectAll:o})};l.prototype.onTableRowsBound=function(e){t.prototype.onTableRowsBound.apply(this,arguments);c(this,e)};l.prototype.onTableUnbindRows=function(){t.prototype.onTableUnbindRows.apply(this,arguments);this._suspend();this.clearSelection();this._resume()};function c(e,t){if(t){t.attachChange(e._onBindingChange,e)}}function r(e,t){if(t){t.detachChange(e._onBindingChange,e)}}l.prototype._onBindingChange=function(e){var t=typeof e==="object"?e.getParameter("reason"):e;if(t==="sort"||t==="filter"){this.clearSelection()}};return l});