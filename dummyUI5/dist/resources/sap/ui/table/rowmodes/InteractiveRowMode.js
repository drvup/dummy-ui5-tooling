/*
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../library","./RowMode","../utils/TableUtils","sap/base/Log","sap/ui/thirdparty/jquery"],function(t,e,o,i,n){"use strict";var r=e.extend("sap.ui.table.rowmodes.InteractiveRowMode",{metadata:{library:"sap.ui.table",final:true,properties:{rowCount:{type:"int",defaultValue:10,group:"Appearance"},minRowCount:{type:"int",defaultValue:5,group:"Appearance"},fixedTopRowCount:{type:"int",defaultValue:0,group:"Appearance"},fixedBottomRowCount:{type:"int",defaultValue:0,group:"Appearance"},rowContentHeight:{type:"int",defaultValue:0,group:"Appearance"}}},constructor:function(t){Object.defineProperty(this,"bLegacy",{value:typeof t==="boolean"?t:false});e.apply(this,arguments)}});var a={};var s={};r.prototype.attachEvents=function(){e.prototype.attachEvents.apply(this,arguments);o.addDelegate(this.getTable(),a,this)};r.prototype.detachEvents=function(){e.prototype.detachEvents.apply(this,arguments);o.removeDelegate(this.getTable(),a)};r.prototype.registerHooks=function(){e.prototype.registerHooks.apply(this,arguments);o.Hook.register(this.getTable(),o.Hook.Keys.Table.RefreshRows,this._onTableRefreshRows,this)};r.prototype.deregisterHooks=function(){e.prototype.deregisterHooks.apply(this,arguments);o.Hook.deregister(this.getTable(),o.Hook.Keys.Table.RefreshRows,this._onTableRefreshRows,this)};r.prototype.getRowCount=function(){if(this.bLegacy){var t=this.getTable();return t?t.getVisibleRowCount():0}return this.getProperty("rowCount")};r.prototype.getFixedTopRowCount=function(){if(this.bLegacy){var t=this.getTable();return t?t.getFixedRowCount():0}return this.getProperty("fixedTopRowCount")};r.prototype.getFixedBottomRowCount=function(){if(this.bLegacy){var t=this.getTable();return t?t.getFixedBottomRowCount():0}return this.getProperty("fixedBottomRowCount")};r.prototype.getMinRowCount=function(){if(this.bLegacy){var t=this.getTable();return t?t.getMinAutoRowCount():0}return this.getProperty("minRowCount")};r.prototype.getRowContentHeight=function(){if(this.bLegacy){var t=this.getTable();return t?t.getRowHeight():0}return this.getProperty("rowContentHeight")};r.prototype.getMinRequestLength=function(){return this.getConfiguredRowCount()};r.prototype.getComputedRowCounts=function(){return this.computeStandardizedRowCounts(this.getConfiguredRowCount(),this.getFixedTopRowCount(),this.getFixedBottomRowCount())};r.prototype.getTableStyles=function(){return{height:"auto"}};r.prototype.getTableBottomPlaceholderStyles=function(){return undefined};r.prototype.getRowContainerStyles=function(){var t=this.getComputedRowCounts().count*this.getBaseRowHeightOfTable()+"px";if(this.bLegacy&&!o.isVariableRowHeightEnabled(this.getTable())){return{minHeight:t}}else{return{height:t}}};r.prototype.renderRowStyles=function(t){var e=this.getRowContentHeight();if(e>0){t.style("height",this.getBaseRowHeightOfTable()+"px")}};r.prototype.renderCellContentStyles=function(t){var e=this.getRowContentHeight();if(this.bLegacy){return}if(e<=0){e=this.getDefaultRowContentHeightOfTable()}if(e>0){t.style("max-height",e+"px")}};r.prototype.getBaseRowContentHeight=function(){return Math.max(0,this.getRowContentHeight())};r.prototype._onTableRefreshRows=function(){var t=this.getConfiguredRowCount();if(t>0){this.initTableRowsAfterDataRequested(t);this.getRowContexts(t,true)}};r.prototype.getConfiguredRowCount=function(){return Math.max(0,this.getMinRowCount(),this.getRowCount())};a.onBeforeRendering=function(t){var e=t&&t.isMarked("renderRows");if(this.bLegacy){this.getTable().setVisibleRowCount(this.getComputedRowCounts().count)}if(!e){this.updateTable(o.RowsUpdateReason.Render)}};a.onAfterRendering=function(t){var e=this.getTable();var i=t&&t.isMarked("renderRows");if(!i&&e.getRows().length>0){this.fireRowsUpdated(o.RowsUpdateReason.Render)}};a.onmousedown=function(t){var e=this.getTable();if(t.button===0&&t.target===e.getDomRef("sb")){s.initInteractiveResizing(e,this,t)}};s.initInteractiveResizing=function(t,e,o){var i=n(document.body);var r=t.$("sb");var a=n(document);var u=r.offset();var p=r.height();var g=r.width();var h=t._isTouchEvent(o);i.on("selectstart",s.onSelectStartWhileInteractiveResizing);i.append('<div id="'+t.getId()+'-ghost" class="sapUiTableInteractiveResizerGhost" style =" height:'+p+"px; width:"+g+"px; left:"+u.left+"px; top:"+u.top+'px" ></div>');r.append('<div id="'+t.getId()+'-rzoverlay" style ="left: 0px; right: 0px; bottom: 0px; top: 0px; position:absolute" ></div>');a.on((h?"touchend":"mouseup")+".sapUiTableInteractiveResize",s.exitInteractiveResizing.bind(t,e));a.on((h?"touchmove":"mousemove")+".sapUiTableInteractiveResize",s.onMouseMoveWhileInteractiveResizing.bind(t));t._disableTextSelection()};s.exitInteractiveResizing=function(t,e){var o=n(document.body);var i=n(document);var r=this.$();var a=this.$("ghost");var u=s.getEventPosition(this,e).y;var p=u-r.find(".sapUiTableCCnt").offset().top-a.height()-r.find(".sapUiTableFtr").height();var g=Math.floor(p/t.getBaseRowHeightOfTable());var h=Math.max(1,g,t.getMinRowCount());if(t.bLegacy){h=Math.max(h,t.getFixedTopRowCount()+t.getFixedBottomRowCount()+1);this.setVisibleRowCount(h)}t.setRowCount(h);a.remove();this.$("rzoverlay").remove();o.off("selectstart",s.onSelectStartWhileInteractiveResizing);i.off("touchend.sapUiTableInteractiveResize");i.off("touchmove.sapUiTableInteractiveResize");i.off("mouseup.sapUiTableInteractiveResize");i.off("mousemove.sapUiTableInteractiveResize");this._enableTextSelection()};s.onSelectStartWhileInteractiveResizing=function(t){t.preventDefault();t.stopPropagation();return false};s.onMouseMoveWhileInteractiveResizing=function(t){var e=s.getEventPosition(this,t).y;var o=this.$().offset().top;if(e>o){this.$("ghost").css("top",e+"px")}};s.getEventPosition=function(t,e){var o;function i(o){if(!t._isTouchEvent(o)){return null}var i=["touches","targetTouches","changedTouches"];for(var n=0;n<i.length;n++){var r=i[n];if(e[r]&&e[r][0]){return e[r][0]}if(e.originalEvent[r]&&e.originalEvent[r][0]){return e.originalEvent[r][0]}}return null}o=i(e)||e;return{x:o.pageX,y:o.pageY}};return r});